{{define "PageTitle"}} UIS Autograder {{end}}
{{define "Headline"}}{{.Org.ScreenName}}{{end}}
{{define "Subtext"}}{{.Org.Description}}{{end}}
{{define "body"}}

<div class="container">
  <div class="row">
    <div class="col-md-3">
      <h1><!-- Something something --></h1>
  	  <div class="list-group">
        <a class="list-group-item disabled">Scoreboards</a>
        <a class="list-group-item active" href="#alltime">All time <span class="pull-right glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
        <a class="list-group-item" href="#month">This month <span class="pull-right glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
        <a class="list-group-item" href="#week">This week <span class="pull-right glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
        <!--<a class="list-group-item disabled">History</a>-->
        <!--<a class="list-group-item">Add calender</a>-->
        <a class="list-group-item" href="/course/{{.Org.Name}}"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span><span class="pull-right">Back to lab page</span></a>
      </div>
    </div>
    <div class="col-md-9">
      <h1>Top Students <span class="period">in total</span></h1>
      <div class="row">
        <div class="col-md-11">
          <p class="lead" id="userposition"><span class="text-muted">You are #<span id="userplace"></span> on the scoreboard <span class="period">in total</span> with <span id="userpoints">0</span> points!</span></p>
          <p class="lead" id="nonscoreboard" style="disply: none;">What? No one on the list? Go and start a discussion on GitHub and you will soon be on the top!</p>
          <div class="alert alert-danger" role="alert" style="disply: none;">...</div>
        </div>
      </div>

      <table class="table table-responsive">
        <thead>
          <tr>
            <th class="col-md-1"></th>
            <th class="col-md-4">Students</th>
            <th class="col-md-2"></th>
            <th class="col-md-3"></th>
            <th class="col-md-2"></th>
          </tr>
        </thead>
        <tbody>
          <tr class="scorerow" place="0" style="display: none;">
            <td><img class="media-object" src="/img/flaticon/number0.png" alt="1" width="48px" style="display: block; margin-left: auto; margin-right: auto;"></td>
            <td style="padding-top: 15px;"><span class="username lead" place="0">u</span></td>
            <td></td>
            <td style="padding-top: 15px;"><span class="lead pull-right"><span class="points" place="0">0</span> points!</span></td>
            <td></td>
          </tr>

          <tr class="scorerow" place="1" style="display: none;">
            <td><img class="media-object" src="/img/flaticon/number1.png" alt="2" width="48px" style="display: block; margin-left: auto; margin-right: auto;"></td>
            <td style="padding-top: 15px;"><span class="username lead" place="1">u</span></td>
            <td></td>
            <td style="padding-top: 15px;"><span class="lead pull-right"><span class="points" place="1">0</span> points!</span></td>
            <td></td>
          </tr>

          <tr class="scorerow" place="2" style="display: none;">
            <td><img class="media-object" src="/img/flaticon/number2.png" alt="3" width="48px" style="display: block; margin-left: auto; margin-right: auto;"></td>
            <td style="padding-top: 15px;"><span class="username lead" place="2">u</span></td>
            <td></td>
            <td style="padding-top: 15px;"><span class="lead pull-right"><span class="points" place="2">0</span> points!</span></td>
            <td></td>
          </tr>

          <tr class="scorerow" place="3" style="display: none;">
            <td><img class="media-object" src="/img/flaticon/number3.png" alt="4" width="32px" style="display: block; margin-left: auto; margin-right: auto;"></td>
            <td style="padding-top: 8px;"><span class="username lead" place="3">u</span></td>
            <td></td>
            <td style="padding-top: 8px;"><span class="lead pull-right"><span class="points" place="3">0</span> points!</span></td>
            <td></td>
          </tr>

          <tr class="scorerow" place="4" style="display: none;">
            <td><img class="media-object" src="/img/flaticon/number4.png" alt="5" width="32px" style="display: block; margin-left: auto; margin-right: auto;"></td>
            <td style="padding-top: 8px;"><span class="username lead" place="4">u</span></td>
            <td></td>
            <td style="padding-top: 8px;"><span class="lead pull-right"><span class="points" place="4">0</span> points!</span></td>
            <td></td>
          </tr>

          <tr class="scorerow" place="5" style="display: none;">
            <td><img class="media-object" src="/img/flaticon/number5.png" alt="6" width="32px" style="display: block; margin-left: auto; margin-right: auto;"></td>
            <td><span class="username lead" place="5">u</span></td>
            <td></td>
            <td style="padding-top: 8px;"><span class="lead pull-right"><span class="points" place="5">0</span> points!</span></td>
            <td></td>
          </tr>

          <tr class="scorerow" place="6" style="display: none;">
            <td><img class="media-object" src="/img/flaticon/number6.png" alt="7" width="32px" style="display: block; margin-left: auto; margin-right: auto;"></td>
            <td style="padding-top: 8px;"><span class="username lead" place="6">u</span></td>
            <td></td>
            <td style="padding-top: 8px;"><span class="lead pull-right"><span class="points" place="6">0</span> points!</span></td>
            <td></td>
          </tr>

          <tr class="scorerow" place="7" style="display: none;">
            <td><img class="media-object" src="/img/flaticon/number7.png" alt="8" width="32px" style="display: block; margin-left: auto; margin-right: auto;"></td>
            <td style="padding-top: 8px;"><span class="username lead" place="7">u</span></td>
            <td></td>
            <td style="padding-top: 8px;"><span class="lead pull-right"><span class="points" place="7">0</span> points!</span></td>
            <td></td>
          </tr>

          <tr class="scorerow" place="8" style="display: none;">
            <td><img class="media-object" src="/img/flaticon/number8.png" alt="9" width="32px" style="display: block; margin-left: auto; margin-right: auto;"></td>
            <td style="padding-top: 8px;"><span class="username lead" place="8">u</span></td>
            <td></td>
            <td style="padding-top: 8px;"><span class="lead pull-right"><span class="points" place="8">0</span> points!</span></td>
            <td></td>
          </tr>
        </tbody>
      </table>

    </div>
  </div>
</div>

<script type="text/javascript">
  var course = "{{.Org.Name}}"
  var user = "{{.Member.Username}}"
  // TODO: get json score data from server and update score info


  var TOTALSCORE = 0
  var MONTHLYSCORE = 1
  var WEEKLYSCORE = 2

  var loadLeadboard = function(period, week, month){
    hideleaderboard();
    $.getJSON("/leaderboard", {"course": course, "period": period, "week": week, "month": month}, function(data){
      if(data.Error){
        $('div.alert').text(data.ErrorMsg).show();
        return
      } else {
        $('div.alert').hide();
      }

      if(data.Leaderboard == null){
        $('#userposition').hide();
        $('#nonscoreboard').show();
        $('table').hide();
        return
      }

      if(data.Leaderboard.length == 0){
        $('#userposition').hide();
        $('#nonscoreboard').show();
        $('table').hide();
        return
      } else {
        $('#nonscoreboard').hide();
        $('#userposition').show();
      }

      $('table').show();

      var found = false
      data.Leaderboard.forEach(function(u, i) {
        if(i <= 10){
          $('.username[place='+i+']').text(u);
          var p = data.Scores[u];
          $('.points[place='+i+']').text(p);
          $('.scorerow').promise().done(function(){
            $('.scorerow[place='+i+']').fadeIn(500 * (1+i));
          });
        }

        if(u == user){
          found = true
          if(i>10){
            $('#userposition').show();
            $("span#userplace").text(i+1)
            $("span#userpoints").text(data.Scores[u])
          } else {
            $('#userposition').hide();
          }
        }
      });

      if(!found) {
        $('#userposition').show();
        $("span#userplace").text(data.Leaderboard.length+1)
        $("span#userpoints").text(0)
      }
    }).fail(function(){
      $('div.alert').text("Could not contact the server to get the scoreboard.").show();
    });
  }

  var hideleaderboard = function(){
    $('.scorerow').each(function(i){
      i = 10-i
      $(this).fadeOut((100 * (1+i)) - (i*10))
    });
  }

  $(function(){
    loadLeadboard(TOTALSCORE, "", "");
  });

  $('a[href=#week]').click(function(){
    loadLeadboard(WEEKLYSCORE, "", "");
    $("span.period").text("this week");

    $('a.list-group-item').removeClass('active');
    $('a[href=#week]').addClass('active')
  });

  $('a[href=#month]').click(function(){
    loadLeadboard(MONTHLYSCORE, "", "");
    $("span.period").text("this month");

    $('a.list-group-item').removeClass('active');
    $('a[href=#month]').addClass('active')
  });

  $('a[href=#alltime]').click(function(){
    loadLeadboard(TOTALSCORE, "", "");
    $("span.period").text("in total");

    $('a.list-group-item').removeClass('active');
    $('a[href=#alltime]').addClass('active')
  });

</script>

{{end}}
